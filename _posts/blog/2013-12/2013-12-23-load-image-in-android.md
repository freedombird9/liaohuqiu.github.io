---
layout: post
title:  Load Image In Android
description: 
category: blog
---
<h2> {{ page.title }} </h2>

### 需要解决的问题

1. 无网络环境下图片不可用
    * 图片的本地缓存
    
2. 低配置机型，加载图像资源超内存(OutOfMemory, OoM)
    * 需要合理使用内存

3. ListView, GridView等控件
    * 初始化或者移动过程中，列表项的重复绘制导致图片重复加载多次
    * 列表快速滑动后，停止区域图像没有被快速加载

      > 快速滑动过程中，在getView中进行图像加载逻辑，在随后view被复用于加载另外的不同的图片
      > 前一个加载应该立即被取消，保证新的加载应该很快被执行
    * 往前或往后滑动之后，反向滑动,之前已浏览过区域，等待图片重新加载

      在逆向滑动后，之前的图像应该立刻被加载
    * 快速滑动过程中，列表卡顿

      快速滑动过程中，频繁的图像的加载，创建和释放，可能导致内存回收

4. 缓存使用, 配额管理
    * 缓存图像(Bitmap)于内存，命中缓存的图像可立刻加载，但限于zygoate虚拟机内存有限
        * 过大的内存占用，容易造成OoM
        * 占用用户过多内存，造成用户反感
    * 缓存文件于sd卡或者机身存储，配额管理
        * 应该适度使用用户机器资源
        * 应用卸载后，不应该有遗留数据


5. 图片复用
    * 比如用户头像，120x120图像下载到本地之后，如有80x80的需求, 无需再次下载，直接复用120x120图片


6. 图片的尺寸的适配
    * 如无特殊指定，可根据ImageView尺寸适配最合适尺寸的图
    * 大部分的图片存储服务，支持通过拼接不同url获得不同尺寸，不同质量, 不同格式(`webp`)的图片

      需要根据不同的尺寸需求，拼接不同的url
    >  各图片存储拼接格式不同，此为具体的业务逻辑，应该有足够好的扩展性,支持不同的拼接方式

### 现有的解决方案的问题

1. Volley
    * 根据ImageView自动加载

    * list view / grid view 首项被多次加载，存在问题
    * 无内存缓存
    * 无图片复用
    * 无缓存配额管理

2. BitmapFun
    * 复用和缓存

    * list view / grid view 首项被多次加载，存在问题
    * 无图片复用
    * 过量缓存使用: HttpDiskCache / LRU Cache 之后，又有一个Cache


3. novoda/ImageLoader
    * github 上流行的图片加载方案

    * list view / grid view 首项被多次加载，存在问题
    * 无缓存配额管理
    * 无图片复用
    * 无自动适配

<p> {{ page.date | date_to_string }} </p>
